<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Syst√®me solaire</title>
    <style>
        body { margin: 0;overflow: hidden; }
    </style>
</head>
<body>
<script type="module">
    import * as THREE from '../three.js-master/build/three.module.js';
    import { OrbitControls } from '../three.js-master/examples/jsm/controls/OrbitControls.js';
    import {GUI} from "../three.js-master/examples/jsm/libs/dat.gui.module.js";
    import Stats from '../three.js-master/examples/jsm/libs/stats.module.js';
    import { GLTFLoader } from '../three.js-master/examples/jsm/loaders/GLTFLoader.js';
    import { FlyControls } from '../three.js-master/examples/jsm/controls/FlyControls.js';

    let scene, camera, renderer, stats, controls;
    let sun, mercury, mars, earth, earthGhost, moon, venus, jupiter, saturn, ring, uranus, neptune, spaceship;
    let alpha_mercury = 0;
    let alpha_venus = 15
    let alpha_moon = 10;
    let alpha_earth = 10;
    let alpha_mars = 20
    let alpha_jupiter = 0
    let alpha_saturn = 10
    let alpha_uranus = 15
    let alpha_neptune = 20

    let alpha_speed = 0.001;

    let alpha_ship=0,beta_ship=0,gamma_ship=0,x_ship=0,y_ship=0,z_ship=0;


    // SPACESHIP
    // -----------------------------------------
    const loader = new GLTFLoader();
    loader.load( '../three.js-master/examples/models/spaceship/scene.glb', function ( ship ) {
        ship.scene.position.set(0,0,0);
        ship.scene.scale.set(10,10,10);
        spaceship = ship.scene;
        // console.log("loaded");
        // console.log(ship);
        init();
        animate();
    }, undefined, function ( error ) {
        //console.error( error );
    } );

    function init(){
        camera = new THREE.PerspectiveCamera(70, window.innerWidth/innerHeight,1,10000);

        scene = new THREE.Scene();

        // SUN
        // -----------------------------------------
        const sunTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_sun.jpg" );

        const sunGeometry = new THREE.SphereGeometry( 150, 32, 16 );
        const sunMaterial = new THREE.MeshBasicMaterial( { map:sunTexture} );
        sun = new THREE.Mesh( sunGeometry, sunMaterial );
        scene.add( sun );
        // ------------------------------------------

        // MERCURY
        // -----------------------------------------
        const mercuryTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_mercury.jpg" );

        const mercuryGeometry = new THREE.SphereGeometry( 10, 32, 16 );
        const mercuryMaterial = new THREE.MeshStandardMaterial( { map:mercuryTexture} );
        mercury = new THREE.Mesh( mercuryGeometry, mercuryMaterial );
        mercury.castShadow = true; //default is false
        mercury.receiveShadow = true; //default
        scene.add( mercury );
        // ------------------------------------------

        // MARS
        // -----------------------------------------
        const marsTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_mars.jpg" );

        const marsGeometry = new THREE.SphereGeometry( 18, 32, 16 );
        const marsMaterial = new THREE.MeshStandardMaterial( { map:marsTexture} );
        mars = new THREE.Mesh( marsGeometry, marsMaterial );
        mars.castShadow = true; //default is false
        mars.receiveShadow = true; //default
        scene.add( mars );
        // ------------------------------------------

        // EARTH GHOST
        // -----------------------------------------
        // const earthTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_earth.jpg" );

        const earthGhostGeometry = new THREE.SphereGeometry( 10, 32, 16 );
        const earthGhostMaterial = new THREE.MeshStandardMaterial( { color:0xfff} );
        earthGhost = new THREE.Mesh( earthGhostGeometry, earthGhostMaterial );
        earthGhost.castShadow = true; //default is false
        earthGhost.receiveShadow = true; //default
        // earthGhost.visible = false
        earthGhost.rotation.z = Math.PI / 6
        scene.add( earthGhost );
        // ------------------------------------------

        // EARTH
        // -----------------------------------------
        const earthTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_earth.jpg" );

        const earthGeometry = new THREE.SphereGeometry( 25, 32, 16 );
        const earthMaterial = new THREE.MeshStandardMaterial( { map:earthTexture} );
        earth = new THREE.Mesh( earthGeometry, earthMaterial );
        earth.castShadow = true; //default is false
        earth.receiveShadow = true; //default
        earthGhost.add( earth );
        // ------------------------------------------
        const axesHelper = new THREE.AxesHelper( 200 );
        earth.add( axesHelper );

        // MOON
        // -----------------------------------------
        const moonTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_moon.jpg" );

        const moonGeometry = new THREE.SphereGeometry( 5, 32, 16 );
        const moonMaterial = new THREE.MeshStandardMaterial( { map:moonTexture} );
        moon = new THREE.Mesh( moonGeometry, moonMaterial );
        moon.castShadow = true; //default is false
        moon.receiveShadow = true; //default
        scene.add( moon );
        // ------------------------------------------

        // VENUS
        // -----------------------------------------
        const venusTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_venus.jpg" );

        const venusGeometry = new THREE.SphereGeometry( 25, 32, 16 );
        const venusMaterial = new THREE.MeshStandardMaterial( { map:venusTexture} );
        venus = new THREE.Mesh( venusGeometry, venusMaterial );
        venus.castShadow = true; //default is false
        venus.receiveShadow = true; //default
        scene.add( venus );
        // ------------------------------------------

        // JUPITER
        // -----------------------------------------
        const jupiterTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_jupiter.jpg" );

        const jupiterGeometry = new THREE.SphereGeometry( 40, 32, 16 );
        const jupiterMaterial = new THREE.MeshStandardMaterial( { map:jupiterTexture} );
        jupiter = new THREE.Mesh( jupiterGeometry, jupiterMaterial );
        jupiter.castShadow = true; //default is false
        jupiter.receiveShadow = true; //default
        scene.add( jupiter );
        // ------------------------------------------

        // SATURN
        // -----------------------------------------
        const saturnTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_saturn.jpg" );

        const saturnGeometry = new THREE.SphereGeometry( 40, 32, 16 );
        const saturnMaterial = new THREE.MeshStandardMaterial( { map:saturnTexture} );
        saturn = new THREE.Mesh( saturnGeometry, saturnMaterial );
        saturn.castShadow = true; //default is false
        saturn.receiveShadow = true; //default
        scene.add( saturn );
        // ------------------------------------------

        // RING
        // ------------------------------------------
        const ringTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_ring.png" );
        const ringGeometry = new THREE.RingGeometry( 50, 60, 32 );
        const ringMaterial = new THREE.MeshStandardMaterial( { map:ringTexture, side: THREE.DoubleSide } );
        ring = new THREE.Mesh( ringGeometry, ringMaterial );
        ring.rotation.x=1.2;
        ring.castShadow = true; //default is false
        ring.receiveShadow = true; //default
        scene.add( ring );
        //-------------------------------------------

        // URANUS
        // -----------------------------------------
        const uranusTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_uranus.jpg" );

        const uranusGeometry = new THREE.SphereGeometry( 40, 32, 16 );
        const uranusMaterial = new THREE.MeshStandardMaterial( { map:uranusTexture} );
        uranus = new THREE.Mesh( uranusGeometry, uranusMaterial );
        uranus.castShadow = true; //default is false
        uranus.receiveShadow = true; //default
        scene.add( uranus );
        // ------------------------------------------

        // NEPTUNE
        // -----------------------------------------
        const neptuneTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_neptune.jpg" );

        const neptuneGeometry = new THREE.SphereGeometry( 40, 32, 16 );
        const neptuneMaterial = new THREE.MeshStandardMaterial( { map:neptuneTexture} );
        neptune = new THREE.Mesh( neptuneGeometry, neptuneMaterial );
        neptune.castShadow = true; //default is false
        neptune.receiveShadow = true; //default
        scene.add( neptune );
        // ------------------------------------------

        // SKYBOX
        // ------------------------------------------
        const skyBoxTexture = new THREE.TextureLoader().load( "../three.js-master/examples/textures/2k_stars_milky_way.jpg" );

        const skyBoxGeometry = new THREE.SphereGeometry( 3000, 32, 16 );
        const skyBoxMaterial = new THREE.MeshBasicMaterial( { map:skyBoxTexture, side: THREE.DoubleSide } );
        const skyBox = new THREE.Mesh( skyBoxGeometry, skyBoxMaterial );
        scene.add( skyBox );
        // ------------------------------------------

        // GUI
        // ------------------------------------------
        const gui = new GUI()
        const params = {
            speed:1,
            fps:true
        }
        gui.add(params,'speed',-100,100).step(0.1).name('Vitesse').onChange(function (v){
            alpha_speed = v/1000;
            render();
        })
        // gui.add(params,'fps').name('fps').onChange(function(){
        //
        // })
        // ------------------------------------------

        // STATS
        // ------------------------------------------
        stats = new Stats();
        document.body.appendChild( stats.dom );
        // ------------------------------------------

        // LIGHT & SHADOW
        // ------------------------------------------

        //Create a PointLight and turn on shadows for the light
        const light = new THREE.PointLight( 0xffffff, 1, 0 );
        light.position.set( 0, 0, 10 );
        light.castShadow = true; // default false
        scene.add( light );

        //Set up shadow properties for the light
        light.shadow.mapSize.width = 512; // default
        light.shadow.mapSize.height = 512; // default
        light.shadow.camera.near = 0.5; // default
        light.shadow.camera.far = 10000; // default
        // -----------------------------------------





        const ambientLight = new THREE.AmbientLight( 0x404040 ); // soft white light
        scene.add( ambientLight );

        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap; // default THREE.PCFShadowMap
        document.body.appendChild( renderer.domElement );
        onWindowResize();
        window.addEventListener( 'resize', onWindowResize );

        // FLY
        // const controls = new FlyControls( camera, renderer.domElement );
        //
        // controls.movementSpeed = 1000;
        // controls.domElement = renderer.domElement;
        // controls.rollSpeed = Math.PI / 24;
        // controls.autoForward = false;
        // controls.dragToLook = false;
        //

        // ORBIT CONTROL
        controls = new OrbitControls( camera, renderer.domElement );
        // controls.enableKeys = true
        controls.keys = {
            LEFT: 'KeyA', //left arrow
            UP: 'KeyW', // up arrow
            RIGHT: 'KeyD', // right arrow
            BOTTOM: 'KeyS' // down arrow
        }
        //
        //controls.update() must be called after any manual changes to the camera's transform

        camera.position.set(0,150,400);
        camera.rotation.x=-0.3;

        scene.add( spaceship);
        spaceship.rotation.y = Math.PI;


        spaceship.rotation.x = camera.rotation.x + 0.7;
        spaceship.rotation.y = camera.rotation.y + Math.PI;
        spaceship.rotation.z = -1*camera.rotation.z;

        controls.update();
    }

    function animate() {

        requestAnimationFrame( animate );


        spaceship.position.x = Math.cos(alpha_ship)*(x_ship);
        spaceship.position.y = Math.cos(beta_ship)*(y_ship);
        spaceship.position.z = Math.cos(gamma_ship)*(z_ship);

        sun.rotation.y += alpha_speed;
        mercury.rotation.y += alpha_speed;
        mars.rotation.y += alpha_speed;
        earth.rotation.y += alpha_speed;
        venus.rotation.y += alpha_speed;
        jupiter.rotation.y += alpha_speed;
        saturn.rotation.y += alpha_speed;
        ring.rotation.z += alpha_speed;
        uranus.rotation.y += alpha_speed;
        moon.rotation.y += alpha_speed;
        neptune.rotation.y += alpha_speed;

        mercury.position.x = Math.cos(alpha_mercury)*(180);
        mercury.position.z = Math.sin(alpha_mercury)*(180);
        alpha_mercury += alpha_speed;

        venus.position.x = Math.cos(alpha_venus)*(220);
        venus.position.z = Math.sin(alpha_venus)*(220);
        alpha_venus += 0.9*alpha_speed;

        earthGhost.position.x = Math.cos(alpha_earth)*(285);
        earthGhost.position.z = Math.sin(alpha_earth)*(285);
        alpha_earth += 0.8*alpha_speed;

        mars.position.x = Math.cos(alpha_mars)*(355);
        mars.position.z = Math.sin(alpha_mars)*(355);
        alpha_mars += 0.7*alpha_speed;

        moon.position.x =earth.position.x + (Math.cos(alpha_moon)*(35));
        moon.position.z =earth.position.z + (Math.sin(alpha_moon)*(35));
        alpha_moon -= 5 * alpha_speed;

        jupiter.position.x =(Math.cos(alpha_jupiter)*(450));
        jupiter.position.z =(Math.sin(alpha_jupiter)*(450));
        alpha_jupiter -= 0.6*alpha_speed;

        saturn.position.x =(Math.cos(alpha_saturn)*(560));
        saturn.position.z =(Math.sin(alpha_saturn)*(560));
        alpha_saturn -= 0.5*alpha_speed;

        ring.position.x =(Math.cos(alpha_saturn)*(560));
        ring.position.z =(Math.sin(alpha_saturn)*(560));
        alpha_saturn -= 0.4*alpha_speed;

        uranus.position.x =(Math.cos(alpha_uranus)*(700));
        uranus.position.z =(Math.sin(alpha_uranus)*(700));
        alpha_uranus -= 0.3*alpha_speed;

        neptune.position.x =(Math.cos(alpha_neptune)*(900));
        neptune.position.z =(Math.sin(alpha_neptune)*(900));
        alpha_neptune += 0.2*alpha_speed;

        // earth.position.z -= 0.01;
        // earth.position.x = Math.sqrt(Math.pow(210)-Math.pow(earth.position.z));

        //controls.update();
        render()

    }



    function logKey(e) {
        console.log(e.code)
        if(e.code==="KeyW"){
            z_ship -= 0.001
        }
        if(e.code==="KeyS"){
            spaceship.position.z += 0.001
        }
        if(e.code==="KeyA"){
            spaceship.position.x -= 0.001
        }
        if(e.code==="KeyD"){
            spaceship.position.x += 0.001
        }
        if(e.code==="Numpad8"){
            spaceship.rotation.x -= 0.001
            alpha_ship -= 0.001
        }
        if(e.code==="Numpad2"){
            spaceship.rotation.x += 0.001
            alpha_ship += 0.001
        }
        setCam()
    }

    function render() {

        renderer.render( scene, camera );
        stats.update();

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    function setCam() {
        camera.position.x = spaceship.position.x;
        camera.position.y = spaceship.position.y + 50;
        camera.position.z = spaceship.position.z + 20;
    }

</script>
</body>
</html>